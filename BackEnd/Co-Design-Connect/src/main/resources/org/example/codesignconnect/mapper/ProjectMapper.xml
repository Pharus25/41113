<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.codesignconnect.mapper.ProjectMapper">

    <!-- 获取所有未被删除的项目 -->
    <select id="getAllProjects" resultType="org.example.codesignconnect.model.Project">
        SELECT * FROM projects
        WHERE is_deleted = 0
        ORDER BY create_time DESC
    </select>

    <!-- 通过 ID 获取项目 -->
    <select id="getProjectById" resultType="org.example.codesignconnect.model.Project">
        SELECT * FROM projects
        WHERE id = #{id} AND is_deleted = 0
    </select>

    <!-- 插入项目 -->
    <insert id="insertProject" parameterType="org.example.codesignconnect.model.Project">
        INSERT INTO projects (
            name, creator_id, status, description, image_url,
            channel_id, category, deadline, tags
        ) VALUES (
                     #{name}, #{creatorId}, #{status}, #{description}, #{imageUrl},
                     #{channelId}, #{category}, #{deadline}, #{tags}
                 )
    </insert>

    <!-- 更新项目 -->
    <update id="updateProject" parameterType="org.example.codesignconnect.model.Project">
        UPDATE projects
        SET name = #{name},
            status = #{status},
            description = #{description},
            image_url = #{imageUrl},
            channel_id = #{channelId},
            category = #{category},
            deadline = #{deadline},
            tags = #{tags},
            region = #{region},
            update_time = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>

    <!-- 删除项目（逻辑删除） -->
    <update id="deleteProjectById" parameterType="int">
        UPDATE projects
        SET is_deleted = 1
        WHERE id = #{id}
    </update>

</mapper>
